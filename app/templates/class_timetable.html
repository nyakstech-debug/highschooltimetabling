{% extends "base.html" %}

{% block title %}{{ class_obj.level }} {{ class_obj.name }} Timetable - SchoolTimetable{% endblock %}

{% block content %}
<style>
    .timetable-container {
        overflow-x: auto;
        margin: 20px 0;
    }
    
    .timetable-grid {
        width: 100%;
        border-collapse: collapse;
        font-family: Arial, sans-serif;
        background-color: white;
    }
    
    .timetable-grid th, .timetable-grid td {
        border: 2px solid #333;
        padding: 8px;
        text-align: center;
        font-size: 12px;
        min-height: 60px;
        vertical-align: middle;
    }
    
    .timetable-grid th {
        background-color: #cccccc;
        font-weight: bold;
        height: auto;
    }
    
    .timetable-grid td {
        background-color: #f5f5f5;
    }
    
    .day-header {
        font-weight: bold;
        font-size: 13px;
        background-color: #999;
        color: white;
    }
    
    .time-header {
        background-color: #999;
        color: white;
        font-weight: bold;
        font-size: 11px;
    }
    
    .period-cell {
        background-color: #ddd;
        font-weight: bold;
        width: 40px;
    }
    
    .lesson-cell {
        background-color: #e8f4f8;
        border: 1px solid #ccc;
        padding: 4px;
        font-size: 11px;
        line-height: 1.3;
    }
    
    .lesson-subject {
        font-weight: bold;
        color: #0066cc;
    }
    
    .lesson-teacher {
        color: #666;
        font-size: 10px;
    }
    
    .lesson-time {
        color: #999;
        font-size: 9px;
    }
    
    .empty-cell {
        background-color: #fff;
    }
    
    .title-section {
        margin-bottom: 20px;
    }
    
    .timetable-info {
        margin-bottom: 15px;
        padding: 10px;
        background-color: #f9f9f9;
        border-left: 4px solid #0066cc;
    }
    
    @media print {
        body {
            margin: 0;
            padding: 10px;
        }
        .btn, .card-header, .card-body > p, .col-md-2, .row > div:last-child {
            display: none;
        }
        .timetable-container {
            page-break-inside: avoid;
        }
        .timetable-grid {
            width: 100%;
            margin-top: 10px;
        }
        .title-section h2 {
            margin-top: 0;
            font-size: 18px;
        }
        .timetable-info {
            margin-bottom: 10px;
            font-size: 12px;
        }
    }
</style>

<div class="row">
    <div class="col-md-12">
        <div class="title-section">
            <h2>{{ class_obj.level }} {{ class_obj.name }} - Weekly Timetable</h2>
            <div class="timetable-info">
                <strong>Class:</strong> {{ class_obj.level }} {{ class_obj.name }} | 
                <strong>Total Subjects:</strong> {{ lessons|map(attribute='subject')|unique(attribute='id')|list|length }} | 
                <strong>Total Lessons:</strong> {{ lessons|length }}
            </div>
        </div>

        <div class="timetable-container">
            <table class="timetable-grid">
                <thead>
                    <tr>
                        <th colspan="2" class="period-cell"></th>
                        <th class="time-header">08:20<br>09:00</th>
                        <th class="time-header">09:00<br>09:40</th>
                        <th class="time-header">09:40<br>10:20</th>
                        <th class="time-header">10:20<br>11:00</th>
                        <th class="time-header">11:00<br>11:40</th>
                        <th class="time-header">11:40<br>12:20</th>
                        <th class="time-header">12:20<br>13:00</th>
                        <th class="time-header">14:00<br>14:40</th>
                        <th class="time-header">14:40<br>15:20</th>
                        <th class="time-header">15:20<br>16:00</th>
                    </tr>
                </thead>
                <tbody>
                    {% set days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'] %}
                    {% set periods = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] %}
                    
                    {% for day in days %}
                    <tr>
                        <td colspan="2" class="day-header">{{ day[:3].upper() }}</td>
                        {% for period in periods %}
                            {% set lesson = lessons|selectattr('time_slot')|selectattr('time_slot.period', 'equalto', period)|list|first %}
                            <td class="{% if lesson %}lesson-cell{% else %}empty-cell{% endif %}">
                                {% if lesson %}
                                    <div class="lesson-subject">{{ lesson.subject.code }}</div>
                                    <div class="lesson-teacher">{{ lesson.teacher.name }}</div>
                                    <div class="lesson-time">{{ lesson.time_slot.start_time }}-{{ lesson.time_slot.end_time }}</div>
                                {% else %}
                                    <span class="text-muted">-</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div style="margin-top: 20px;">
            <button class="btn btn-primary" onclick="window.print()">Print Timetable</button>
            <a href="{{ url_for('timetable.view_timetable', timetable_id=timetable.id) }}" class="btn btn-secondary">Back</a>
        </div>
    </div>
</div>
{% endblock %}
